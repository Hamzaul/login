{% extends "base.html" %}
{% block title %}Forgot Password Â· Auth UI{% endblock %}

{% block content %}
<section class="card card-body">
  <h1>Forgot Password</h1>
  <p class="muted">Enter your email to get a password reset link.</p>

  <form id="forgotForm" class="form">
    <label>Email
      <input type="email" id="forgotEmail" placeholder="you@example.com" required />
    </label>
    <button type="submit" class="btn primary">Send Reset Link</button>
    <p id="forgotMsg" class="msg"></p>
  </form>
</section>
{% endblock %}

{% block scripts %}
<script>
const forgotForm = document.getElementById("forgotForm");
const forgotEmail = document.getElementById("forgotEmail");
const forgotMsg = document.getElementById("forgotMsg");

function validateEmail(email) {
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return re.test(email.toLowerCase());
}

forgotForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = forgotEmail.value.trim();

  if (!validateEmail(email)) {
    forgotMsg.textContent = "Please enter a valid email address.";
    forgotMsg.style.color = "salmon";
    return;
  }

  try {
    const res = await fetch("/api/forgot-password", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email })
    });
    const data = await res.json();
    forgotMsg.textContent = data.message || data.error;
    forgotMsg.style.color = res.ok ? "lightgreen" : "salmon";
  } catch (err) {
    forgotMsg.textContent = "Something went wrong.";
    forgotMsg.style.color = "salmon";
  }
});
</script>
{% endblock %}
